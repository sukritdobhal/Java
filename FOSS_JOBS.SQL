-------------------------JOB 1----------------------------DDL-----------------------


DECLARE 
 V_START_DATE TIMESTAMP WITH TIME ZONE;
BEGIN 

SELECT LOCALTIMESTAMP AT TIME ZONE 'US/EASTERN' INTO V_START_DATE FROM DUAL; --US/EASTERN

EXECUTE IMMEDIATE 'ALTER SESSION SET CURRENT_SCHEMA = DBXNET';
EXECUTE IMMEDIATE Q'[ALTER SESSION SET NLS_TIMESTAMP_TZ_FORMAT = 'MM-DD-YYYY HH24:MI:SS TZR TZD']';
 
   DBMS_SCHEDULER.CREATE_JOB ( 
    JOB_NAME => 'POPULATE_CR_MAIN', 
    JOB_TYPE => 'PLSQL_BLOCK', 
    JOB_ACTION => 'DECLARE BEGIN DBXNET.CREDIT_RECEIVABLES.POPULATE_CR(); END;', 
    START_DATE => V_START_DATE, 
    ENABLED => TRUE, 
    REPEAT_INTERVAL => 'FREQ=DAILY; BYHOUR=21; BYMINUTE=00; BYSECOND=0;'
   ); 
   
END;

--------------------------------------------JOB 2 DDL------------------------------------------------------------------------------


DECLARE 
 V_START_DATE TIMESTAMP WITH TIME ZONE;
BEGIN 

SELECT LOCALTIMESTAMP AT TIME ZONE 'US/EASTERN' INTO V_START_DATE FROM DUAL; --US/EASTERN

EXECUTE IMMEDIATE 'ALTER SESSION SET CURRENT_SCHEMA = DBXNET';
EXECUTE IMMEDIATE Q'[ALTER SESSION SET NLS_TIMESTAMP_TZ_FORMAT = 'MM-DD-YYYY HH24:MI:SS TZR TZD']';
 
   DBMS_SCHEDULER.CREATE_JOB ( 
    JOB_NAME => 'POPULATE_CR_BACK', 
    JOB_TYPE => 'PLSQL_BLOCK', 
    JOB_ACTION => 'DECLARE BEGIN DBXNET.CREDIT_RECEIVABLES.POPULATE_CR_BACK_UP(); END;', 
    START_DATE => V_START_DATE, 
    ENABLED => TRUE, 
    REPEAT_INTERVAL => 'FREQ=DAILY; BYHOUR=20; BYMINUTE=00; BYSECOND=0;'
   ); 
   
END;
-----------------------------------------------------------------------------------------------------------------------------------------
-----BOTH JOBS ARE CONFIGURED IN FOSSSIT (HOST: SRLVLP-ORA01, SERVICE NAME: FOSSSIT) AND FOSSTEST (HOST: SRLVLP-ORA01, SERVICE NAME: FOSSTEST
-----JOB RUNS FINE IN FOSSTEST BUT DOESNT RUN IN FOSSIT.
------SOME VALIDATION QUERIES:

SELECT LOG_DATE, JOB_NAME, STATUS, RUN_DURATION
FROM DBA_SCHEDULER_JOB_RUN_DETAILS WHERE JOB_NAME IN ('POPULATE_CR_MAIN', 'POPULATE_CR_BACK') ORDER BY LOG_DATE DESC; 

SELECT VALUE FROM V$PARAMETER WHERE NAME='JOB_QUEUE_PROCESSES';

SELECT ATTRIBUTE_NAME,  VALUE
FROM DBA_SCHEDULER_GLOBAL_ATTRIBUTE
WHERE ATTRIBUTE_NAME = 'SCHEDULER_DISABLED';

SELECT LOCALTIMESTAMP AT TIME ZONE 'US/EASTERN' FROM DUAL;

SELECT * FROM ALL_SCHEDULER_JOBS;

SELECT DBMS_SCHEDULER.STIME FROM DUAL;

--04-12-2024 06:43:47 AMERICA/NEW_YORK EDT
ALTER SESSION SET NLS_TIMESTAMP_TZ_FORMAT = 'MM-DD-YYYY HH24:MI:SS TZR TZD';
---------------------------------------------------------------------------------------------------------------------------------------
BEGIN
EXECUTE IMMEDIATE 'ALTER SESSION SET CURRENT_SCHEMA = DBXNET';
DBMS_SCHEDULER.RUN_JOB('POPULATE_CR_MAIN');
END;


SELECT LOG_DATE, JOB_NAME, STATUS, RUN_DURATION
FROM DBA_SCHEDULER_JOB_RUN_DETAILS WHERE JOB_NAME IN ('POPULATE_CR_MAIN', 'POPULATE_CR_BACK') ORDER BY LOG_DATE DESC; 
